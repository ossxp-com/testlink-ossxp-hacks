From: Jiang Xin <worldhello.net@gmail.com>
Subject: [PATCH] t/custom_config

Custom config files.

Signed-off-by: Jiang Xin <worldhello.net@gmail.com>

---
 cfg/const.inc.php                                  |   14 +-
 config.inc.php                                     |    2 +-
 custom_config.inc.php.example                      |  127 ++++++++++++--------
 install/sql/mysql/testlink_create_default_data.sql |    2 +-
 4 files changed, 85 insertions(+), 60 deletions(-)

diff --git a/cfg/const.inc.php b/cfg/const.inc.php
index 837fee0..27160f9 100644
--- a/cfg/const.inc.php
+++ b/cfg/const.inc.php
@@ -427,12 +427,12 @@ $tlCfg->reportsCfg=new stdClass();
 
 // BUGID 1785
 // With this change configuration is simplified
-// $tlCfg->reportsCfg->exec_status = array(
-//     "passed"  => "test_status_passed",
-//     "failed"  => "test_status_failed",
-//     "blocked" => "test_status_blocked",
-//     "not_run" => "test_status_not_run"
-// );
+$tlCfg->reportsCfg->exec_status = array(
+    "passed"  => "test_status_passed",
+    "failed"  => "test_status_failed",
+    "blocked" => "test_status_blocked",
+    "not_run" => "test_status_not_run"
+);
 $tlCfg->reportsCfg->exec_status = $tlCfg->results['status_label_for_exec_ui'];
 
 
@@ -651,4 +651,4 @@ $tlCfg->gui->custom_fields->time_format = "H:i:s";
                                                        
 
 // ----- END ----------------------------------------------------------------------------
-?>
\ No newline at end of file
+?>
diff --git a/config.inc.php b/config.inc.php
index 4f20a54..0480918 100644
--- a/config.inc.php
+++ b/config.inc.php
@@ -112,7 +112,7 @@ require_once(TL_ABS_PATH . 'cfg' . DIRECTORY_SEPARATOR . 'const.inc.php');
 // The value must be available in $g_locales (see cfg/const.inc.php).
 // Note: An attempt will be done to establish the default locale 
 // automatically using $_SERVER['HTTP_ACCEPT_LANGUAGE']
-$tlCfg->default_language = 'en_GB'; 
+$tlCfg->default_language = 'zh_CN'; 
 
 /** 
  * Charset 'UTF-8' is only officially supported charset (Require MySQL version >= 4.1)
diff --git a/custom_config.inc.php.example b/custom_config.inc.php.example
index 698ec68..b505480 100644
--- a/custom_config.inc.php.example
+++ b/custom_config.inc.php.example
@@ -40,55 +40,6 @@
 // Your reports WILL BE ON TOP OF standard TL Reports on left frame
 //
 //
-// $tlCfg->gui->text_editor['all'] = array( 'type' => 'fckeditor', 
-//                                          'toolbar' => 'tl_default', 
-//                                          'configFile' => 'cfg/tl_fckeditor_config.js');
-//
-// Copy this to custom_config.inc.php if you want use 'tinymce' as default.
-//$tlCfg->gui->text_editor['all'] = array( 'type' => 'tinymce');
-// 
-// Copy this to custom_config.inc.php if you want use 'nome' as default.
-// $tlCfg->gui->text_editor['all'] = array( 'type' => 'none');
-//
-// Suggested for BETTER Performance with lot of testcases
-//$tlCfg->gui->text_editor['execution'] = array( 'type' => 'none');
-//
-// Enable and configure this if you want to have different
-// webeditor type in different TL areas
-// You can not define new areas without making changes to php code
-//
-// $tlCfg->gui->text_editor['execution'] = array( 'type' => 'none');  // BETTER Performance with lot of testcases
-// 
-// This configuration is useful only if default type is set to 'fckeditor'
-// $tlCfg->gui->text_editor['design'] = array('toolbar' => 'tl_mini');
-// 
-// $tlCfg->gui->text_editor['testplan'] = array( 'type' => 'none');
-// $tlCfg->gui->text_editor['build'] = array( 'type' => 'fckeditor','toolbar' => 'tl_mini');
-// $tlCfg->gui->text_editor['testproject'] = array( 'type' => 'tinymce');
-// $tlCfg->gui->text_editor['role'] = array( 'type' => 'tinymce');
-// $tlCfg->gui->text_editor['requirement'] = array( 'type' => 'none');
-// $tlCfg->gui->text_editor['requirement_spec'] = array( 'type' => 'none');
-//
-//
-// SMTP server Configuration ("localhost" is enough in the most cases)
-//$g_smtp_host        = 'localhost';  # SMTP server MUST BE configured  
-
-# Configure using custom_config.inc.php
-//$g_tl_admin_email     = 'tl_admin@127.0.0.1'; # for problem/error notification 
-//$g_from_email         = 'testlink@127.0.0.1';  # email sender
-//$g_return_path_email  = 'francisco@127.0.0.1';
-
-# Urgent = 1, Not Urgent = 5, Disable = 0
-// $g_mail_priority = 5;   
-
-# Taken from mantis for phpmailer config
-#define ("SMTP_SEND",2);
-#$g_phpMailer_method = SMTP_SEND;
-
-// Configure only if SMTP server requires authentication
-//$g_smtp_username    = '';  # user  
-//$g_smtp_password    = '';  # password 
-//
 
 // TRUE  -> the whole execution history for the choosen build will be showed
 // FALSE -> just last execution for the choosen build will be showed [STANDARD BEHAVIOUR]
@@ -104,8 +55,6 @@
 // FALSE ->  Only history of the current build will be shown  [STANDARD BEHAVIOUR]
 //$tlCfg->exec_cfg->show_history_all_builds = TRUE;
 
-//$tlCfg->treemenu_type='JTREE';
-
 // $tlCfg->gui->custom_fields->types = array(100 => 'radio head');
 // $tlCfg->gui->custom_fields->possible_values_cfg = array('radio head' => 1);
 
@@ -140,4 +89,80 @@
 // ); 
 // 
 // $tlCfg->results['default_status'] = "not_run"; 
+
+// ----------------------------------------------------------------------------
+/** [User Authentication] */                 
+
+/** 
+ * Login authentication method:
+ * 		'MD5' => use password stored on db
+ * 		'LDAP' => use password from LDAP Server
+ * 		'COSIGN' => Cosign Single Sign-on v2 (with the ldap backends)
+ * 		'COSIGN3' => Cosign Single Sign-on v3 (with the ldap backends)
+ */ 
+/** Before enable COSIGN login, add your self as administrator */
+//$tlCfg->authentication['method'] = 'MD5';  # Default
+//$tlCfg->authentication['method'] = 'LDAP';
+//$tlCfg->authentication['method'] = 'COSIGN3';
+$tlCfg->authentication['login_url'] = 'https://weblogin.foo.bar/cgi-bin/login';
+$tlCfg->authentication['logout_url'] = 'https://weblogin.foo.bar/cgi-bin/logout';
+
+/** LDAP authentication credentials */
+$tlCfg->authentication['ldap_server']		= 'localhost';
+$tlCfg->authentication['ldap_port']			= '389';
+$tlCfg->authentication['ldap_version']		= '3'; // could be '2' in some cases
+$tlCfg->authentication['ldap_root_dn']		= 'dc=foo,dc=bar';
+$tlCfg->authentication['ldap_organization']	= '';    // e.g. '(authorizedService=testlink)'
+$tlCfg->authentication['ldap_uid_field']	= 'uid'; // Use 'sAMAccountName' for Active Directory
+$tlCfg->authentication['ldap_firstname_field']	= 'givenName';
+$tlCfg->authentication['ldap_lastname_field']	= 'sn';
+$tlCfg->authentication['ldap_fullname_field']	= 'cn';
+$tlCfg->authentication['ldap_email_field']	    = 'mail';
+$tlCfg->authentication['ldap_bind_dn']		= ''; // Left empty for anonymous LDAP binding 
+$tlCfg->authentication['ldap_bind_passwd']	= ''; // Left empty for anonymous LDAP binding 
+
+/** Enable/disable Users to create accounts on login page */
+// $tlCfg->user_self_signup = FALSE; 
+
+// ----------------------------------------------------------------------------
+/** [SMTP] */
+
+// SMTP server Configuration ("localhost" is enough in the most cases)
+$g_smtp_host        = 'localhost';  # SMTP server MUST BE configured  
+
+# Configure using custom_config.inc.php
+$g_tl_admin_email     = 'webmaster@foo.bar'; # for problem/error notification 
+$g_from_email         = 'testlink@foo.bar';  # email sender
+$g_return_path_email  = 'noreply@foo.bar';
+
+# Urgent = 1, Not Urgent = 5, Disable = 0
+// $g_mail_priority = 5;   
+
+// Configure only if SMTP server requires authentication
+$g_smtp_username    = '';  # user  
+$g_smtp_password    = '';  # password 
+
+// ----------------------------------------------------------------------------
+/** [Bug Tracking systems] */
+//$g_interface_bugs = 'REDMINE';
+
+/** Company logo (used by navigation bar and login page page) */
+//$tlCfg->company_logo = '<img alt="TestLink" title="TestLink" style="width: 115px; height: 53px;" src="' . 
+//                          $tlCfg->theme_dir . 'images/company_logo.png" />';
+//$tlCfg->company_logo = 'company_logo.png';
+
+// ----------------------------------------------------------------------------
+/** [LOCALIZATION] */
+$tlCfg->default_language = 'zh_CN'; 
+
+/** 
+ *  How to warning user when security weak points exists.
+ *
+ * 'SCREEN': messages will displayed on login screen, and tl desktop (default)
+ * 'FILE': a file with a list is created but users are not notified via GUI
+ *         user will receive a message on screen.
+ * 'SILENT': same that FILE, but user will not receive message on screen.
+ */
+//$tlCfg->config_check_warning_mode = "SILENT";
+
 ?>
diff --git a/install/sql/mysql/testlink_create_default_data.sql b/install/sql/mysql/testlink_create_default_data.sql
index fd0b246..345cf1f 100644
--- a/install/sql/mysql/testlink_create_default_data.sql
+++ b/install/sql/mysql/testlink_create_default_data.sql
@@ -134,7 +134,7 @@ INSERT INTO `role_rights` (role_id,right_id) VALUES (9,16);
 # admin account 
 # SECURITY: change password after first login
 INSERT INTO `users` (login,password,role_id,email,first,last,locale,active)
-             VALUES ('admin','21232f297a57a5a743894a0e4a801fc3', 8,'', 'Testlink', 'Administrator', 'en_GB',1);
+             VALUES ('admin','21232f297a57a5a743894a0e4a801fc3', 8,'', 'Testlink', 'Administrator', 'zh_CN',1);
 
 # Assignment types
 INSERT INTO assignment_types (id,fk_table,description) VALUES(1,'testplan_tcversions','testcase_execution');
-- 
tg: (4a1bc5f..) t/custom_config (depends on: master t/typos_no_last_eol)
